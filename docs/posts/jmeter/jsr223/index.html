<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="ç”¨groovyè„šæœ¬å¤„ç†æ•°æ®"><title>Jmeter ç”¨è„šæœ¬å¤„ç†å™¨å¯¹æ•°æ®è¿›è¡Œå¤„ç†</title><link rel=canonical href=https://mapleafgo.github.io/posts/jmeter/jsr223/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="Jmeter ç”¨è„šæœ¬å¤„ç†å™¨å¯¹æ•°æ®è¿›è¡Œå¤„ç†"><meta property="og:description" content="ç”¨groovyè„šæœ¬å¤„ç†æ•°æ®"><meta property="og:url" content="https://mapleafgo.github.io/posts/jmeter/jsr223/"><meta property="og:site_name" content="æ…•æ«çš„leaf"><meta property="og:type" content="article"><meta property="article:section" content="Posts"><meta property="article:tag" content="Jmeter"><meta property="article:tag" content="æµ‹è¯•è„šæœ¬"><meta property="article:published_time" content="2021-03-04T16:06:29+08:00"><meta property="article:modified_time" content="2021-03-04T16:06:29+08:00"><meta name=twitter:title content="Jmeter ç”¨è„šæœ¬å¤„ç†å™¨å¯¹æ•°æ®è¿›è¡Œå¤„ç†"><meta name=twitter:description content="ç”¨groovyè„šæœ¬å¤„ç†æ•°æ®"></head><body class=article-page><script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script><div class="container main-container flex
on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header class=site-info><figure class=site-avatar><img src=/img/avatar_hu688c9895da43354b2f6ec843bf28cefb_2353_300x0_resize_box_2.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
<span class=emoji>ğŸ¥</span></figure><h1 class=site-name><a href=https://mapleafgo.github.io>æ…•æ«çš„leaf</a></h1><h2 class=site-description>ç»™è‡ªå·±ç•™ä¸ªåº•</h2></header><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>ä¸»é¡µ</span></a></li><li><a href=/about><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>å…³äº</span></a></li><li><a href=/archives><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>å½’æ¡£</span></a></li><li><a href=/search><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>æœç´¢</span></a></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>æš—è‰²æ¨¡å¼</span></li></ol></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/test/>æµ‹è¯•</a></header><h2 class=article-title><a href=/posts/jmeter/jsr223/>Jmeter ç”¨è„šæœ¬å¤„ç†å™¨å¯¹æ•°æ®è¿›è¡Œå¤„ç†</a></h2><h3 class=article-subtitle>ç”¨groovyè„šæœ¬å¤„ç†æ•°æ®</h3><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>2021-03-04</time></footer></div></header><section class=article-content><blockquote><p>å‰ä¸¤å¤©åœ¨é¡¹ç›®ä¸­å†™ jmeter æµ‹è¯•è„šæœ¬ï¼Œé¡¹ç›®ä¸­å”¯ä¸€ ID å¾—è°ƒç”¨ç«¯è¯·æ±‚æ—¶ç”Ÿæˆå¹¶ä¼ é€ï¼Œäºæ˜¯æŸ¥èµ„æ–™ã€ç¿»å®˜ç½‘æ–‡æ¡£ï¼Œç»ˆäºå†™å‡ºæ¥äº†ã€‚</p></blockquote><blockquote><p>ç¤ºä¾‹ä¸­æˆ‘ä»¬ä½¿ç”¨ç®€å•çš„ç™¾åº¦ç¿»è¯‘çš„è¯å…¸ API è¯·æ±‚ json æ•°æ®ã€‚</p></blockquote><p>è¯´æ˜ä¸‹ï¼Œè¿™é‡Œä¸ºå•¥è¦ç”¨ groovy è„šæœ¬ï¼Œå› ä¸ºå®˜ç½‘è¯´ groovy è„šæœ¬ä¼šç¼“å­˜ç¼–è¯‘ç»“æœï¼Œå¯æé«˜æ€§èƒ½ã€‚è€Œä¸” groovy è„šæœ¬åŸºæœ¬è·Ÿ Java æ²¡å•¥åŒºåˆ«</p><h3 id=é¦–å…ˆå…ˆåˆ›å»ºä¸ªç®€å•çš„-http-è¯·æ±‚>é¦–å…ˆå…ˆåˆ›å»ºä¸ªç®€å•çš„ HTTP è¯·æ±‚</h3><ul><li>æ‰“å¼€ jmeter åï¼Œå…ˆåœ¨æ ¹èŠ‚ç‚¹(Test Plan)ä¸‹æ–°å»ºä¸ªçº¿ç¨‹ç»„(Thread Group)ï¼Œé»˜è®¤çš„çº¿ç¨‹ç»„é…ç½®å°±å¤Ÿæˆ‘ä»¬æœ¬æ¬¡ç¤ºä¾‹ç”¨äº†</li><li>åœ¨çº¿ç¨‹ç»„ä¸‹æ–°å»ºä¸ª Http è¯·æ±‚(HTTP Request)ï¼Œå†æ–°å»ºä¸ªç»“æœæ ‘å±•ç¤º(View Results Tree)</li><li>é…ç½® Http è¯·æ±‚ï¼Œé¦–å…ˆæ˜¯åè®®(Protocol): <code>https</code> ï¼ŒæœåŠ¡åœ°å€(Server Name): <code>fanyi.baidu.com</code> ï¼Œè¯·æ±‚ç±»å‹: <code>POST</code> ï¼ŒPath: <code>/sug</code></li><li>æ·»åŠ ä¸ªè¯·æ±‚å‚æ•°(Parameters)ï¼Œç‚¹å‡»<code>Add</code>ï¼ŒName: <code>kw</code>ï¼ŒValue: <code>test</code></li><li>ç‚¹å‡»è¿è¡Œï¼Œæˆ–è€…ä½¿ç”¨å¿«æ·é”®<code>Ctrl+R</code>ï¼Œè¿è¡Œç»“æŸåœ¨ç»“æœæ ‘ä¸­æŸ¥çœ‹ç»“æœï¼Œçœ‹çœ‹æ˜¯å¦è¯·æ±‚æˆåŠŸ</li></ul><h3 id=åœ¨å‘èµ·è¯·æ±‚å‰å¡«å……æ•°æ®>åœ¨å‘èµ·è¯·æ±‚å‰ï¼Œå¡«å……æ•°æ®</h3><blockquote><p>é¦–å…ˆè¯´è¯´æˆ‘ä»¬è¦è¾¾åˆ°çš„é¢„æœŸï¼Œæˆ‘ä»¬è¦åœ¨è¯·æ±‚å‚æ•°ä¸­æ¸…ç†æ‰åŸæœ¬<code>kw</code>å‚æ•°çš„<code>test</code>å€¼ï¼Œå¡«å……ä¸Šæ–°çš„å‚æ•°å€¼<code>success</code></p></blockquote><blockquote><p>åœ¨å†™ä¸‹é¢çš„ä¸œè¥¿å‰ï¼Œå…ˆé™„ä¸Š<a class=link href=https://jmeter.apache.org/usermanual/component_reference.html#JSR223_PreProcessor target=_blank rel=noopener>å®˜æ–¹æ–‡æ¡£</a>ï¼Œè¿™æ˜¯ JSR233 å‰ç½®å¤„ç†å™¨çš„æ–‡æ¡£ã€‚</p></blockquote><ul><li><p>å…ˆåœ¨ Http è¯·æ±‚èŠ‚ç‚¹ä¸‹æ–°å»ºä¸ª JSR223 å‰ç½®å¤„ç†å™¨(JSR223 PreProcessor)ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥åœ¨åŒçº§èŠ‚ç‚¹å»º(ä¸è¿‡å¿…é¡»è¦åœ¨è¯·æ±‚èŠ‚ç‚¹å)ï¼ŒåŒçº§å»ºçš„è¯ï¼Œå¤„ç†å™¨çš„ä½œç”¨åŸŸå°±æ˜¯åŒçº§èŠ‚ç‚¹çš„æ‰€æœ‰è¯·æ±‚</p></li><li><p>é€‰æ‹©è„šæœ¬ <code>groovy</code></p></li><li><p>ç¼–å†™è„šæœ¬</p><div class=highlight><pre class=chroma><code class=language-groovy data-lang=groovy><span class=c1>// è·å–è¯·æ±‚å‚æ•°
</span><span class=c1></span><span class=kt>def</span> <span class=n>params</span> <span class=o>=</span> <span class=n>sampler</span><span class=o>.</span><span class=na>getArguments</span><span class=o>();</span>
<span class=c1>// è·å–ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¿™é‡Œæ’åºè·Ÿè¯·æ±‚èŠ‚ç‚¹çš„å‚æ•°é¡ºåºæŒ‚é’©
</span><span class=c1></span><span class=kt>def</span> <span class=n>kw</span> <span class=o>=</span> <span class=n>params</span><span class=o>.</span><span class=na>getArgument</span><span class=o>(</span><span class=mi>0</span><span class=o>);</span>
<span class=c1>// èµ‹äºˆkwæ–°å€¼
</span><span class=c1></span><span class=n>kw</span><span class=o>.</span><span class=na>setValue</span><span class=o>(</span><span class=s2>&#34;success&#34;</span><span class=o>);</span>
</code></pre></div></li><li><p>è¿è¡Œæµ‹è¯•ä¸‹è¯·æ±‚å‚æ•°æ˜¯å¦å·²ç»æ›´æ”¹</p></li></ul><p>å†™åˆ°è¿™é‡Œï¼Œæˆ‘çœŸçš„å¿ä¸ä½æƒ³åæ§½ä¸‹ï¼Œè¿™è¯·æ±‚å‚æ•°è—çš„å¤Ÿæ·±çš„å•Š ğŸ˜‘ å®˜æ–¹æ–‡æ¡£ä¹Ÿæ²¡å†™è¿™ç‚¹ï¼Œè¦ä¸æ˜¯çœ‹ API æ–‡æ¡£ï¼Œè¿˜çœŸå°±ä¸ä¸€å®šå‘ç°çš„äº† Argumentsã€‚å®˜æ–¹æ–‡æ¡£é‡Œ <code>Parameters</code>ã€<code>args</code>ã€<code>ctx</code>ã€<code>props</code>éƒ½è¯•äº†ï¼Œæ´»ç”Ÿç”Ÿè®©æˆ‘è¯•å‡ºæ¥çš„å•Š ğŸ˜¤ï¼ï¼ï¼</p><h3 id=åœ¨è¯·æ±‚ç»“æŸåå¯¹è¿”å›çš„æ•°æ®è¿›è¡Œæ ¼å¼åŒ–å¤„ç†>åœ¨è¯·æ±‚ç»“æŸåï¼Œå¯¹è¿”å›çš„æ•°æ®è¿›è¡Œæ ¼å¼åŒ–å¤„ç†</h3><blockquote><p>è¿”å›æ•°æ®çš„å¤„ç†ï¼Œä¸»è¦æ˜¯å¯¹è¿”å›çš„æ•°æ®è¿›è¡Œè§£ç ã€Json æ ¼å¼çš„ç¼©è¿›å±•ç¤º</p></blockquote><blockquote><p>åç½®å¤„ç†å°±æ–¹ä¾¿çš„å¤šäº†ï¼Œåœ¨ JSR223 åç½®å¤„ç†å™¨(JSR223 PostProcessor)ä¸­ï¼Œæœ‰<code>prev</code>å‚æ•°å¯ç›´æ¥æ“ä½œç»“æœé›†</p></blockquote><ul><li><p>åŒå‰ç½®å¤„ç†å™¨ä¸€æ ·ï¼Œå…ˆå»ºä¸ª JSR223 åç½®å¤„ç†å™¨èŠ‚ç‚¹ï¼Œä½œç”¨åŸŸåŒå‰ç½®å¤„ç†å™¨</p></li><li><p>åŒæ ·ï¼Œè„šæœ¬é€‰æ‹©<code>groovy</code></p></li><li><p>ç¼–å†™è„šæœ¬</p><div class=highlight><pre class=chroma><code class=language-groovy data-lang=groovy><span class=kn>import</span> <span class=nn>groovy.json.JsonOutput</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.apache.commons.lang3.StringEscapeUtils</span><span class=o>;</span>
<span class=c1>// å­—ç¬¦ä¸²çš„å½¢å¼è¯»å–è¿”å›æ•°æ®
</span><span class=c1></span><span class=kt>def</span> <span class=n>data</span> <span class=o>=</span> <span class=n>prev</span><span class=o>.</span><span class=na>getResponseDataAsString</span><span class=o>();</span>
<span class=c1>// æ ¼å¼åŒ–jsonæ•°æ®
</span><span class=c1></span><span class=kt>def</span> <span class=n>json</span> <span class=o>=</span> <span class=n>JsonOutput</span><span class=o>.</span><span class=na>prettyPrint</span><span class=o>(</span><span class=n>data</span><span class=o>);</span>
<span class=c1>// å¯¹æ•°æ®è¿›è¡ŒUnicodeè½¬ä¸­æ–‡çš„è§£ç 
</span><span class=c1></span><span class=kt>def</span> <span class=n>ret</span> <span class=o>=</span> <span class=n>StringEscapeUtils</span><span class=o>.</span><span class=na>unescapeJava</span><span class=o>(</span><span class=n>json</span><span class=o>);</span>
<span class=c1>// æŠŠæˆ‘ä»¬è½¬æ¢åçš„æ•°æ®è®¾ç½®ä¸ºè¿”å›ç»“æœï¼Œç¼–ç è®¾ç½®ä¸ºUTF-8
</span><span class=c1></span><span class=n>prev</span><span class=o>.</span><span class=na>setResponseData</span><span class=o>(</span><span class=n>ret</span><span class=o>,</span> <span class=s2>&#34;UTF-8&#34;</span><span class=o>);</span>
</code></pre></div></li><li><p>è¿è¡Œæµ‹è¯•ç»“æœï¼Œå®Œç¾ç»“æŸï¼</p></li></ul><p>è‡³æ­¤æ•´ä¸ªå‰ç½®åç½®çš„å¤„ç†å°±å®Œç¾äº†</p></section><footer class=article-footer><section class=article-tags><a href=/tags/jmeter/>Jmeter</a>
<a href=/tags/%E6%B5%8B%E8%AF%95%E8%84%9A%E6%9C%AC/>æµ‹è¯•è„šæœ¬</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-contents--wrapper></aside><link rel=stylesheet href=https://unpkg.com/vssue/dist/vssue.min.css><div id=vssue></div><script src=https://unpkg.com/vue/dist/vue.runtime.min.js></script><script src=https://unpkg.com/vssue/dist/vssue.github.min.js></script><script>new Vue({el:"#vssue",render:a=>a("Vssue",{props:{title:"Jmeter ç”¨è„šæœ¬å¤„ç†å™¨å¯¹æ•°æ®è¿›è¡Œå¤„ç†",options:{autoCreateIssue:!0,owner:"mapleafgo",repo:"mapleafgo.github.io",clientId:"5983b8490feaac79bca3",clientSecret:"5bf636663572a7fd99da378f6aee7c3e95099024"}}})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2021 æ…•æ«çš„leaf</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=2.5.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script></body></html>